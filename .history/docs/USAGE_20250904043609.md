# Usage Guide

## Overview

The Corporate SSL Certificate Manager provides three main scripts for different environments:

1. **`Install-CorporateSSL-WSL.ps1`** - WSL certificate configuration
2. **`Install-CorporateSSL-Node.ps1`** - Node.js certificate configuration  
3. **`Install-CorporateSSL-Docker.ps1`** - Docker certificate configuration

Each script can be used independently or together for comprehensive SSL support.

## Environment-Specific Usage

### WSL Environment

#### Basic Usage
```powershell
# Auto-detect and install minimal certificates
.\Install-CorporateSSL-WSL.ps1 -Verbose

# Target specific corporate patterns
.\Install-CorporateSSL-WSL.ps1 -SearchPatterns @("YourCompany", "Corporate CA") -Verbose
```

#### Advanced Usage
```powershell
# Install all effective certificates
.\Install-CorporateSSL-WSL.ps1 -RequireAllCerts -Verbose

# Test against specific domains
.\Install-CorporateSSL-WSL.ps1 -TestDomains @("https://internal.company.com", "https://api.company.com") -Verbose

# Clean installation (remove existing certificates)
.\Install-CorporateSSL-WSL.ps1 -SearchPatterns @("YourCompany") -CleanInstall -Verbose
```

#### WSL Post-Installation Usage
```bash
# Test SSL connectivity
curl -I https://google.com
curl -I https://github.com

# Check installed certificates
ls -la /usr/local/share/ca-certificates/

# Update certificate store
sudo update-ca-certificates --verbose
```

### Node.js Environment

#### Basic Usage
```powershell
# Create certificate bundle and configure environment
.\Install-CorporateSSL-Node.ps1 -SearchPatterns @("YourCompany") -BundleAllCerts -Verbose

# Test certificate effectiveness
.\Install-CorporateSSL-Node.ps1 -SearchPatterns @("Corporate", "CA") -RequireAllCerts -Verbose
```

#### Advanced Usage
```powershell
# Create comprehensive certificate bundle
.\Install-CorporateSSL-Node.ps1 -BundleAllCerts -RequireAllCerts -Verbose

# Test specific timeout settings
.\Install-CorporateSSL-Node.ps1 -TestTimeout 15000 -Verbose

# Dry run to analyze certificates
.\Install-CorporateSSL-Node.ps1 -DryRun -ExportFormat Both -Verbose
```

#### Node.js Post-Installation Usage
```bash
# Check environment variables
echo $NODE_EXTRA_CA_CERTS
echo $NODE_TLS_REJECT_UNAUTHORIZED

# Test SSL connectivity
node tests/test-ssl-connectivity.js

# Test in your application
node -e "const https = require('https'); https.get('https://api.github.com', (res) => console.log('Status:', res.statusCode))"
```

### Docker Environment

#### Basic Usage
```powershell
# Complete Docker setup with cleanup
.\Install-CorporateSSL-Docker.ps1 -SearchPatterns @("YourCompany") -CleanInstall -Verbose

# Basic installation
.\Install-CorporateSSL-Docker.ps1 -SearchPatterns @("Corporate", "CA") -Verbose
```

#### Advanced Usage
```powershell
# Dry run to see what would be configured
.\Install-CorporateSSL-Docker.ps1 -DryRun -Verbose

# Test against specific domains
.\Install-CorporateSSL-Docker.ps1 -TestDomains @("https://registry.company.com", "https://internal.company.com") -Verbose
```

#### Docker Post-Installation Usage
```bash
# Standard Docker registry operations (work automatically)
docker pull node:18
docker pull python:3.12
docker push myregistry.com/myapp

# HTTPS inside containers - use docker-corp
docker-corp run --rm curlimages/curl:latest curl https://google.com
docker-corp run --rm ubuntu curl https://github.com
docker-corp run --rm node:18 npm install express

# Quick tests (restart WSL terminal first)
docker-test-google
docker-test-github
docker-test-npmjs

# Development containers
docker-corp run -it --rm node:18 bash
docker-corp run -it --rm python:3.12 bash
```

## Interactive Usage After Installation

### WSL Daily Usage
```bash
# All standard tools work with HTTPS
curl https://api.github.com
wget https://releases.ubuntu.com/file.iso
git clone https://github.com/user/repo.git
apt update && apt upgrade

# Package managers work
sudo apt install package-name
pip install requests
npm install express
```

### Node.js Daily Usage
```bash
# All Node.js HTTPS requests work
npm install
npm publish
git clone https://github.com/user/repo.git

# API calls work in applications
node -e "require('https').get('https://api.github.com', console.log)"
```

### Docker Daily Usage
```bash
# Registry operations work automatically
docker pull alpine
docker push myregistry.com/myapp
docker build -t myapp .

# Use docker-corp for containers that need HTTPS
docker-corp run --rm node:18 npm install
docker-corp run --rm python:3.12 pip install requests
docker-corp run --rm alpine apk update

# Development workflows
docker-corp run -v $(pwd):/app -w /app node:18 npm start
docker-corp run -v $(pwd):/app -w /app python:3.12 python app.py
```

## Environment Integration

### PowerShell Profile Integration
```powershell
# Add to PowerShell profile for automatic setup
Add-Content $PROFILE @"
# Corporate SSL Certificate Manager
Set-Location 'C:\path\to\corporate-ssl-manager'

function Install-WSLCerts { .\Install-CorporateSSL-WSL.ps1 -Verbose }
function Install-NodeCerts { .\Install-CorporateSSL-Node.ps1 -BundleAllCerts -Verbose }
function Install-DockerCerts { .\Install-CorporateSSL-Docker.ps1 -CleanInstall -Verbose }
"@
```

### WSL Profile Integration
```bash
# Add to ~/.bashrc for convenient aliases
echo 'alias ssl-test-wsl="curl -I https://google.com && curl -I https://github.com"' >> ~/.bashrc
echo 'alias ssl-test-node="node tests/test-ssl-connectivity.js"' >> ~/.bashrc
echo 'alias ssl-test-docker="docker-test-google && docker-test-github"' >> ~/.bashrc
```

## Script Parameters Reference

### Common Parameters

| Parameter | Description | Default | Example |
|-----------|-------------|---------|---------|
| `SearchPatterns` | Certificate search patterns | Auto-detected | `@("YourCompany", "CA")` |
| `ExcludeIssuers` | Public CAs to exclude | Common public CAs | `@("DigiCert", "Let's Encrypt")` |
| `TestDomains` | Domains for testing | Popular sites | `@("https://internal.company.com")` |
| `DryRun` | Analyze without installing | `$false` | `-DryRun` |
| `Verbose` | Detailed output | `$false` | `-Verbose` |

### WSL-Specific Parameters

| Parameter | Description | Default | Example |
|-----------|-------------|---------|---------|
| `WSLDistro` | Target WSL distribution | Auto-detected | `"Ubuntu"` |
| `RequireAllCerts` | Install all effective certificates | `$false` | `-RequireAllCerts` |
| `CleanInstall` | Remove existing certificates first | `$false` | `-CleanInstall` |

### Node.js-Specific Parameters

| Parameter | Description | Default | Example |
|-----------|-------------|---------|---------|
| `BundleAllCerts` | Create certificate bundle | `$false` | `-BundleAllCerts` |
| `TestTimeout` | Timeout for tests (ms) | `10000` | `-TestTimeout 15000` |
| `RequireAllCerts` | Test all certificates | `$false` | `-RequireAllCerts` |

### Docker-Specific Parameters

| Parameter | Description | Default | Example |
|-----------|-------------|---------|---------|
| `CleanInstall` | Clean existing configuration | `$false` | `-CleanInstall` |
| `WSLDistro` | Target WSL distribution | `"Ubuntu"` | `"Debian"` |

## Usage Examples by Scenario

### Scenario 1: New Development Machine
```powershell
# Complete setup for new machine
.\Install-CorporateSSL-WSL.ps1 -Verbose
.\Install-CorporateSSL-Node.ps1 -BundleAllCerts -Verbose
.\Install-CorporateSSL-Docker.ps1 -CleanInstall -Verbose
```

### Scenario 2: Specific Company Setup
```powershell
# Setup for specific corporate environment
$companyPatterns = @("Contoso", "Corporate CA", "Enterprise PKI")

.\Install-CorporateSSL-WSL.ps1 -SearchPatterns $companyPatterns -RequireAllCerts -Verbose
.\Install-CorporateSSL-Node.ps1 -SearchPatterns $companyPatterns -BundleAllCerts -Verbose
.\Install-CorporateSSL-Docker.ps1 -SearchPatterns $companyPatterns -CleanInstall -Verbose
```

### Scenario 3: Troubleshooting SSL Issues
```powershell
# Comprehensive certificate analysis
.\Install-CorporateSSL-WSL.ps1 -DryRun -ExportFormat Both -Verbose
.\Install-CorporateSSL-Node.ps1 -DryRun -RequireAllCerts -Verbose
.\Install-CorporateSSL-Docker.ps1 -DryRun -Verbose

# Then install based on analysis results
.\Install-CorporateSSL-WSL.ps1 -RequireAllCerts -Verbose
.\Install-CorporateSSL-Node.ps1 -BundleAllCerts -RequireAllCerts -Verbose
.\Install-CorporateSSL-Docker.ps1 -CleanInstall -Verbose
```

### Scenario 4: Development Team Setup
```powershell
# Standardized setup for development teams
$teamPatterns = @("YourCompany")
$teamDomains = @("https://api.company.com", "https://registry.company.com", "https://github.com")

.\Install-CorporateSSL-WSL.ps1 -SearchPatterns $teamPatterns -TestDomains $teamDomains -Verbose
.\Install-CorporateSSL-Node.ps1 -SearchPatterns $teamPatterns -BundleAllCerts -Verbose
.\Install-CorporateSSL-Docker.ps1 -SearchPatterns $teamPatterns -TestDomains $teamDomains -CleanInstall -Verbose
```

## Best Practices

### 1. Regular Maintenance
```powershell
# Monthly certificate check
.\Install-CorporateSSL-WSL.ps1 -DryRun -Verbose
.\Install-CorporateSSL-Node.ps1 -DryRun -Verbose
.\Install-CorporateSSL-Docker.ps1 -DryRun -Verbose
```

### 2. Team Standardization
```powershell
# Create team-specific configuration script
$teamConfig = @{
    SearchPatterns = @("YourCompany", "Corporate CA")
    TestDomains = @("https://api.company.com", "https://registry.company.com")
}

.\Install-CorporateSSL-WSL.ps1 @teamConfig -Verbose
.\Install-CorporateSSL-Node.ps1 @teamConfig -BundleAllCerts -Verbose
.\Install-CorporateSSL-Docker.ps1 @teamConfig -CleanInstall -Verbose
```

### 3. CI/CD Integration
```powershell
# Automated setup for CI/CD environments
.\Install-CorporateSSL-WSL.ps1 -SearchPatterns @("YourCompany") -RequireAllCerts
.\Install-CorporateSSL-Node.ps1 -SearchPatterns @("YourCompany") -BundleAllCerts
.\Install-CorporateSSL-Docker.ps1 -SearchPatterns @("YourCompany") -CleanInstall
```

## Support

For additional help:
- Check [Troubleshooting Guide](TROUBLESHOOTING.md)
- Review [Installation Guide](INSTALLATION.md)
- Examine script logs in `logs/` directory
- Test with `-DryRun` parameter first