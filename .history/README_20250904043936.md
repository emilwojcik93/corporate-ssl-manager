# Corporate SSL Certificate Manager

A comprehensive PowerShell solution for automatically identifying, testing, and installing corporate certificates in WSL and Node.js environments to resolve SSL inspection issues.

## ğŸ¯ Purpose

This tool solves the common problem where corporate networks use SSL inspection, causing SSL certificate verification failures in development environments. It automatically:

1. **Discovers** corporate certificates from Windows certificate stores
2. **Tests** each certificate systematically against real domains  
3. **Installs** only effective certificates in target environments
4. **Validates** complete SSL functionality

## ğŸš€ Quick Start

### WSL Environment
```powershell
# Basic usage - auto-detect everything
.\Install-CorporateSSL-WSL.ps1 -Verbose

# Target specific corporate certificates
.\Install-CorporateSSL-WSL.ps1 -SearchPatterns @("YourCompany", "CA") -Verbose

# Dry run to see what would be done
.\Install-CorporateSSL-WSL.ps1 -DryRun -Verbose
```

### Node.js Environment
```powershell
# Install certificates and configure environment variables
.\Install-CorporateSSL-Node.ps1 -SearchPatterns @("YourCompany") -BundleAllCerts -Verbose

# Test SSL connectivity
node tests\test-ssl-connectivity.js
```

### Docker Environment
```powershell
# Complete Docker setup with automatic certificate injection
.\Install-CorporateSSL-Docker.ps1 -SearchPatterns @("YourCompany") -CleanInstall -Verbose

# Test Docker HTTPS connectivity
docker-corp run --rm curlimages/curl:latest curl https://google.com
docker-corp run --rm curlimages/curl:latest curl https://github.com
```

## ğŸ“ Repository Structure

```
corporate-ssl-manager/
â”œâ”€â”€ Install-CorporateSSL-WSL.ps1      # WSL certificate installer
â”œâ”€â”€ Install-CorporateSSL-Node.ps1     # Node.js certificate installer
â”œâ”€â”€ Install-CorporateSSL-Docker.ps1   # Docker certificate installer
â”œâ”€â”€ docker-corp.sh                    # Docker wrapper script
â”œâ”€â”€ docker-corporate-env.sh           # Docker environment setup
â”œâ”€â”€ README.md                         # This file
â”œâ”€â”€ .gitignore                        # Git ignore rules
â”œâ”€â”€ CORPORATE-CERTIFICATE-ANALYSIS.md # General analysis guide
â”œâ”€â”€ docs/                             # Documentation
â”‚   â”œâ”€â”€ INSTALLATION.md               # Step-by-step installation guide
â”‚   â”œâ”€â”€ USAGE.md                      # Detailed usage guide
â”‚   â””â”€â”€ TROUBLESHOOTING.md            # Troubleshooting guide
â”œâ”€â”€ tests/                            # Test scripts
â”‚   â””â”€â”€ test-ssl-connectivity.js      # Node.js SSL test
â””â”€â”€ logs/                             # Generated log files (ignored)
```

## ğŸ”§ Key Features

### Intelligent Certificate Discovery
- **Pattern-based search** for corporate certificates
- **Excludes common public CAs** (DigiCert, Let's Encrypt, etc.)
- **Multi-store scanning** (LocalMachine, CurrentUser)
- **Duplicate detection** and filtering

### Systematic Testing  
- **Pre-installation baseline** testing
- **Individual certificate effectiveness** testing
- **Multi-domain validation** against popular sites
- **Success rate calculation** and reporting

### Environment Integration
- **WSL**: Support for 25+ Linux distributions with auto-detection
- **Node.js**: Environment variable configuration and bundle creation
- **Smart detection** of target environments
- **Prerequisite installation** (curl, ca-certificates)

### Comprehensive Logging
- **Detailed timestamped logs** with color coding
- **Export to CSV/JSON** formats
- **Test result tracking** and analysis
- **Error handling** and recovery

## ğŸ“Š Supported Environments

### WSL Distributions
- **Ubuntu Family**: Ubuntu, Ubuntu-18.04/20.04/22.04/24.04, Debian, Kali Linux
- **RHEL Family**: Fedora, CentOS, RHEL, AlmaLinux, Rocky Linux
- **SUSE Family**: openSUSE Leap/Tumbleweed, SUSE Linux Enterprise
- **Arch Family**: Arch Linux, Manjaro
- **Other**: Alpine Linux

### Node.js Versions
- **Supported**: Node.js 14+ (tested with latest LTS)
- **Platforms**: Windows 10/11, Windows Server 2019/2022

### Docker Environments
- **Docker Engine**: 20.10+ in WSL 2
- **Container Support**: All Linux-based containers
- **Registry Support**: Docker Hub, NPM, PyPI, and custom registries

## ğŸ“‹ Parameters

### WSL Script Parameters
| Parameter | Description | Default |
|-----------|-------------|---------|
| `SearchPatterns` | Patterns to search for in certificates | Corporate, CA, SSL patterns |
| `ExcludeIssuers` | Public CAs to exclude | Common public CAs |
| `WSLDistro` | Target WSL distribution | Auto-detected |
| `TestDomains` | Domains for SSL testing | Popular test domains |
| `RequireAllCerts` | Install all effective certificates | `$false` |
| `DryRun` | Analyze without installing | `$false` |

### Node.js Script Parameters  
| Parameter | Description | Default |
|-----------|-------------|---------|
| `SearchPatterns` | Patterns to search for in certificates | Corporate, CA, SSL patterns |
| `BundleAllCerts` | Create certificate bundle | `$false` |
| `TestTimeout` | Timeout for tests (ms) | `10000` |

## ğŸ” How It Works

### 1. Discovery Phase
```
ğŸ” Scanning certificate stores...
   â”œâ”€â”€ LocalMachine\Root (Trusted Root CAs)
   â”œâ”€â”€ LocalMachine\CA (Intermediate CAs)
   â”œâ”€â”€ CurrentUser\Root (User Trusted Root CAs)
   â””â”€â”€ Pattern matching and filtering
```

### 2. Analysis Phase  
```
ğŸ“Š Analyzing certificates...
   â”œâ”€â”€ Pattern matching (CA, Corporate, SSL...)
   â”œâ”€â”€ Public CA exclusion
   â”œâ”€â”€ Duplicate removal
   â””â”€â”€ Validity checking
```

### 3. Testing Phase
```
ğŸ§ª Testing certificate effectiveness...
   â”œâ”€â”€ Baseline connectivity test
   â”œâ”€â”€ Individual certificate installation
   â”œâ”€â”€ Multi-domain SSL testing
   â””â”€â”€ Success rate calculation
```

### 4. Installation Phase
```
âš™ï¸ Installing effective certificates...
   â”œâ”€â”€ WSL: Copy to certificate directory
   â”œâ”€â”€ Node.js: Create bundle and set env vars
   â”œâ”€â”€ Validation testing
   â””â”€â”€ Cleanup of ineffective certificates
```

## ğŸ“ˆ Example Output

```
[2025-09-04 01:23:45] [TITLE] Processing certificate: Corporate Root CA
[2025-09-04 01:23:46] [SUCCESS] Certificate exported: Corporate_Root_CA_D72F47.crt
[2025-09-04 01:23:47] [SUCCESS] Certificate installed successfully
[2025-09-04 01:23:48] [PROGRESS] Testing certificate effectiveness...
[2025-09-04 01:23:49] [SUCCESS] [OK] https://google.com - Success (HTTP 200)
[2025-09-04 01:23:50] [SUCCESS] [OK] https://github.com - Success (HTTP 200)
[2025-09-04 01:23:51] [SUCCESS] Certificate effectiveness: 6/6 domains (100%)
[2025-09-04 01:23:52] [SUCCESS] All SSL connectivity tests passed!
```

## ğŸ› ï¸ Common Usage Patterns

### Search for Specific Corporate Certificates
```powershell
# Search for your company's certificates
.\Install-CorporateSSL-WSL.ps1 -SearchPatterns @("YourCompany", "Internal CA") -Verbose

# Search for common SSL inspection vendors
.\Install-CorporateSSL-WSL.ps1 -SearchPatterns @("BlueCoat", "Forcepoint", "McAfee") -Verbose
```

### Test Specific Domains
```powershell
# Test against internal corporate domains
.\Install-CorporateSSL-WSL.ps1 -TestDomains @("https://internal.company.com", "https://app.company.com") -Verbose

# Test against problematic external domains
.\Install-CorporateSSL-WSL.ps1 -TestDomains @("https://api.github.com", "https://registry.npmjs.org") -Verbose
```

### Advanced Configuration
```powershell
# Install all effective certificates (comprehensive approach)
.\Install-CorporateSSL-WSL.ps1 -RequireAllCerts -Verbose

# Clean installation (remove existing certificates first)
.\Install-CorporateSSL-WSL.ps1 -CleanInstall -Verbose

# Analysis only (no installation)
.\Install-CorporateSSL-WSL.ps1 -DryRun -ExportFormat Both -Verbose
```

## ğŸ”’ Security Considerations

- **Administrator privileges** required for certificate store access
- **Root access in WSL** required for certificate installation  
- **Corporate compliance** - only installs certificates already trusted by Windows
- **Audit trail** - comprehensive logging of all operations
- **No security bypass** - maintains proper SSL validation

## ğŸ“š Documentation

- **[Usage Guide](docs/USAGE.md)** - Detailed usage instructions and examples
- **[Troubleshooting Guide](docs/TROUBLESHOOTING.md)** - Common issues and solutions
- **[Certificate Analysis](CORPORATE-CERTIFICATE-ANALYSIS.md)** - Technical analysis methodology

## ğŸ§ª Testing

### WSL Testing
```bash
# Verify installed certificates
ls -la /usr/local/share/ca-certificates/
sudo update-ca-certificates --verbose

# Test SSL connectivity
curl -I https://google.com
curl -I https://github.com
```

### Node.js Testing
```javascript
// Check environment variables
console.log('NODE_EXTRA_CA_CERTS:', process.env.NODE_EXTRA_CA_CERTS);

// Test SSL connectivity
node tests/test-ssl-connectivity.js
```

## ğŸ¤ Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests if applicable
5. Submit a pull request

## ğŸ“œ License

This project is licensed under the MIT License.

## ğŸ™ Acknowledgments

- Original WSL certificate installation concept by [emilwojcik93](https://gist.github.com/emilwojcik93/7eb1e172f8bb038e324c6e4a7f4ccaaa)
- WSL distribution support patterns from community contributions
- Corporate SSL inspection best practices from enterprise environments

---

**Note**: This repository contains generic scripts suitable for any corporate environment. Company-specific analysis and implementation details are maintained separately in confidential documentation.